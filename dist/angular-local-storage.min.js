/**
 * An Angular module that gives you access to the browsers local storage
 * @version v0.1.3 - 2014-10-22
 * @link https://github.com/grevory/angular-local-storage
 * @author grevory <greg@gregpike.ca>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */!function(a,b){"use strict";function c(a){return/^-?\d+\.?\d*$/.test(a.replace(/["']/g,""))}function d(a){return"boolean"==typeof a}var e=b.isDefined,f=b.isUndefined,g=b.isNumber,h=b.isObject,i=b.isArray,d=d,j=b.extend,k=b.toJson,l=b.fromJson,m=b.module("LocalStorageModule",[]);m.provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/"},this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(a){this.prefix=a},this.setStorageType=function(a){this.storageType=a},this.setStorageCookie=function(a,b){this.cookie={expiry:a,path:b}},this.setStorageCookieDomain=function(a){this.cookie.domain=a},this.setNotify=function(a,b){this.notify={setItem:a,removeItem:b}},this.$get=["$rootScope","$window","$document","$parse",function(a,b,m,n){var o,p=this,q=p.prefix,r=p.cookie,s=p.notify,t=p.storageType;m?m[0]&&(m=m[0]):m=document,"."!==q.substr(-1)&&(q=q?q+".":"");var u=function(a){return q+a},v=function(){try{var c=t in b&&null!==b[t],d=u("__"+Math.round(1e7*Math.random()));return c&&(o=b[t],o.setItem(d,""),o.removeItem(d)),c}catch(e){return t="cookie",a.$broadcast("LocalStorageModule.notification.error",e.message),!1}}(),w=function(b,c,e){var j={};if(f(c)?c=null:h(c)||i(c)||g(+c||c)?c=k(c):d(c)&&(c=c.toString()),j={date:e||Date.now(),data:c},!v||"cookie"===p.storageType)return v||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),s.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:c,storageType:"cookie"}),C(b,c);try{(h(c)||i(c))&&(c=k(c),j={date:e||Date.now(),data:c}),o&&o.setItem(u(b),JSON.stringify(j)),s.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:b,newvalue:JSON.stringify(j),storageType:p.storageType})}catch(l){return a.$broadcast("LocalStorageModule.notification.error",l.message),C(b,c)}return!0},x=function(b,d){var e,f;if(!v||"cookie"===p.storageType)return v||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),D(b);var g=o?o.getItem(u(b)):null;if(!g||"null"===g)return null;if(g=JSON.parse(g),e=g.data,f=g.date,d){var h=new Date(f).getTime()+d;if(h<Date.now())return null}return"{"===e.charAt(0)||"["===e.charAt(0)||c(e)?l(e):e},y=function(b){if(!v||"cookie"===p.storageType)return v||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),s.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:b,storageType:"cookie"}),E(b);try{o.removeItem(u(b)),s.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:b,storageType:p.storageType})}catch(c){return a.$broadcast("LocalStorageModule.notification.error",c.message),E(b)}return!0},z=function(){if(!v)return a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var b=q.length,c=[];for(var d in o)if(d.substr(0,b)===q)try{c.push(d.substr(b))}catch(e){return a.$broadcast("LocalStorageModule.notification.error",e.Description),[]}return c},A=function(b){b=b||"";var c=q.slice(0,-1),d=new RegExp(c+"."+b);if(!v||"cookie"===p.storageType)return v||a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),F();var e=q.length;for(var f in o)if(d.test(f))try{y(f.substr(e))}catch(g){return a.$broadcast("LocalStorageModule.notification.error",g.message),F()}return!0},B=function(){try{return navigator.cookieEnabled||"cookie"in m&&(m.cookie.length>0||(m.cookie="test").indexOf.call(m.cookie,"test")>-1)}catch(b){return a.$broadcast("LocalStorageModule.notification.error",b.message),!1}},C=function(b,c){if(f(c))return!1;if((i(c)||h(c))&&(c=k(c)),!B())return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var d="",e=new Date,g="";if(null===c?(e.setTime(e.getTime()+-864e5),d="; expires="+e.toGMTString(),c=""):0!==r.expiry&&(e.setTime(e.getTime()+24*r.expiry*60*60*1e3),d="; expires="+e.toGMTString()),b){var j="; path="+r.path;r.domain&&(g="; domain="+r.domain),m.cookie=u(b)+"="+encodeURIComponent(c)+d+j+g}}catch(l){return a.$broadcast("LocalStorageModule.notification.error",l.message),!1}return!0},D=function(b){if(!B())return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var c=m.cookie&&m.cookie.split(";")||[],d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(u(b)+"=")){var f=decodeURIComponent(e.substring(q.length+b.length+1,e.length));try{var g=JSON.parse(f);return l(g)}catch(h){return f}}}return null},E=function(a){C(a,null)},F=function(){for(var a=null,b=q.length,c=m.cookie.split(";"),d=0;d<c.length;d++){for(a=c[d];" "===a.charAt(0);)a=a.substring(1,a.length);var e=a.substring(b,a.indexOf("="));E(e)}},G=function(){return t},H=function(a,b,c,d){d=d||b;var f=x(d);return null===f&&e(c)?f=c:h(f)&&h(c)&&(f=j(c,f)),n(b).assign(a,f),a.$watch(b,function(a){w(d,a)},h(a[b]))},I=function(){for(var a=0,c=b[t],d=0;d<c.length;d++)0===c.key(d).indexOf(q)&&a++;return a};return{isSupported:v,getStorageType:G,set:w,add:w,get:x,keys:z,remove:y,clearAll:A,bind:H,deriveKey:u,length:I,cookie:{set:C,add:C,get:D,remove:E,clearAll:F}}}]})}(window,window.angular);